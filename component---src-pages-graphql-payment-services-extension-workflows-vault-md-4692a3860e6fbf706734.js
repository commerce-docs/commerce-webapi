"use strict";(self.webpackChunkcommerce_webapi=self.webpackChunkcommerce_webapi||[]).push([[6342],{45682:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return p},default:function(){return s}});var n=a(58168),m=a(80045),r=(a(88763),a(15680)),d=a(83407);const l=["components"],p={},o={_frontmatter:p},i=d.A;function s(e){let{components:t}=e,a=(0,m.A)(e,l);return(0,r.mdx)(i,(0,n.A)({},o,a,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"payment-services-vault-workflow"},"Payment Services Vault workflow"),(0,r.mdx)("p",null,"The following diagram shows the workflow for storing a payment method during checkout."),(0,r.mdx)("p",null,(0,r.mdx)("img",{parentName:"p",src:"/commerce-webapi/assets/0cde3c665138898f07d8a60f138c879b/payment-services-paypal-vault.svg",alt:"Payment Services Vault sequence diagram"})),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Use the ",(0,r.mdx)("a",{parentName:"p",href:"../../schema/checkout/queries/customer-payment-tokens.md"},(0,r.mdx)("inlineCode",{parentName:"a"},"customerPaymentTokens"))," query to retrieve the payment tokens the customer stored in the vault.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Commerce returns an array of payment tokens.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"The client integration renders the token information, and the customer selects a payment method."),(0,r.mdx)("p",{parentName:"li"},"When the customer selects a stored payment method, the client integration uses the ",(0,r.mdx)("a",{parentName:"p",href:"../../schema/cart/mutations/set-payment-method.md"},(0,r.mdx)("inlineCode",{parentName:"a"},"setPaymentMethodOnCart"))," mutation to set the payment method to ",(0,r.mdx)("inlineCode",{parentName:"p"},"payment_services_paypal_vault"),".")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Commerce returns a ",(0,r.mdx)("inlineCode",{parentName:"p"},"Cart")," object.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Run ",(0,r.mdx)("inlineCode",{parentName:"p"},"placeOrder"),".")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Commerce sends an authorization request to PayPal.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"PayPal returns the result to Commerce.")),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("p",{parentName:"li"},"Commerce creates an order."))),(0,r.mdx)("h2",{id:"additional-payment-information"},"Additional Payment information"),(0,r.mdx)("p",null,"When you set the payment method to Payment Services Vault in the ",(0,r.mdx)("a",{parentName:"p",href:"../../schema/cart/mutations/set-payment-method.md"},(0,r.mdx)("inlineCode",{parentName:"a"},"setPaymentMethodOnCart"))," mutation, you must supply a value for the ",(0,r.mdx)("inlineCode",{parentName:"p"},"public_hash")," field. Run the ",(0,r.mdx)("a",{parentName:"p",href:"../../schema/checkout/queries/customer-payment-tokens.md"},(0,r.mdx)("inlineCode",{parentName:"a"},"customerPaymentTokens"))," query to retrieve the value."),(0,r.mdx)("p",null,"This ",(0,r.mdx)("inlineCode",{parentName:"p"},"public_hash")," comes from the ",(0,r.mdx)("a",{parentName:"p",href:"../../schema/checkout/queries/customer-payment-tokens.md"},(0,r.mdx)("inlineCode",{parentName:"a"},"customerPaymentTokens"))," query."),(0,r.mdx)("h3",{id:"payment_services_paypal_vault-attributes"},(0,r.mdx)("inlineCode",{parentName:"h3"},"payment_services_paypal_vault")," attributes"),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"setPaymentMethodOnCart")," mutation has a ",(0,r.mdx)("inlineCode",{parentName:"p"},"payment_services_paypal_vault")," object that contains the following attributes:"),(0,r.mdx)("table",null,(0,r.mdx)("thead",{parentName:"table"},(0,r.mdx)("tr",{parentName:"thead"},(0,r.mdx)("th",{parentName:"tr",align:null},"Attribute"),(0,r.mdx)("th",{parentName:"tr",align:null},"Data Type"),(0,r.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,r.mdx)("tbody",{parentName:"table"},(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"payments_order_id")),(0,r.mdx)("td",{parentName:"tr",align:null},"String"),(0,r.mdx)("td",{parentName:"tr",align:null},"The unique order ID generated in Commerce if Payment Services is enabled after PayPal returns the ",(0,r.mdx)("inlineCode",{parentName:"td"},"paypal_order_id"))),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"paypal_order_id")),(0,r.mdx)("td",{parentName:"tr",align:null},"String"),(0,r.mdx)("td",{parentName:"tr",align:null},"The unique order ID generated by PayPal when receiving the authorization request")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"payment_source")),(0,r.mdx)("td",{parentName:"tr",align:null},"String"),(0,r.mdx)("td",{parentName:"tr",align:null},"The identifiable payment source for the payment method. The possible values are credit card, PayPal, and Apple Pay")),(0,r.mdx)("tr",{parentName:"tbody"},(0,r.mdx)("td",{parentName:"tr",align:null},(0,r.mdx)("inlineCode",{parentName:"td"},"public_hash")),(0,r.mdx)("td",{parentName:"tr",align:null},"String"),(0,r.mdx)("td",{parentName:"tr",align:null},"The public hash of the payment token")))),(0,r.mdx)("h3",{id:"example-usage"},"Example usage"),(0,r.mdx)("p",null,"The following example shows the ",(0,r.mdx)("inlineCode",{parentName:"p"},"setPaymentMethodOnCart")," mutation constructed for the Payment Services Vault payment method."),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Request:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-graphql"},'mutation {\n    setPaymentMethodOnCart ( input: {\n        cart_id: "uocGxUi5H97XFAMhY3s66q4aFYG3Bmdr",\n        payment_method: {\n            code: "payment_services_paypal_vault",\n            payment_services_paypal_vault: {\n                payment_source: "vault",\n                payments_order_id: "mp-order-a4babd34-13d3-4ac0-b1b0-109bb7be1574",\n                paypal_order_id: "9R90936863877801D",\n                public_hash: "shew83bdbd83y2bdjbwb2ib2ds"\n            }\n        }\n    }\n    ) {\n        cart {\n            id\n            selected_payment_method {\n                code\n            }\n        }\n    }\n}\n')),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Response:")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "setPaymentMethodOnCart": {\n      "cart": {\n        "id": "r8TKHa58b7Y8VaZHLyABNxrEdS8hJJTZ",\n        "selected_payment_method": {\n          "code": "payment_services_paypal_vault"\n        }\n      }\n    }\n  }\n}\n')))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-graphql-payment-services-extension-workflows-vault-md-4692a3860e6fbf706734.js.map